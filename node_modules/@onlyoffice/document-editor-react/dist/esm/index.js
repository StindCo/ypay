import e,{useEffect as n}from"react";function o(e,n,o,t){return new(o||(o=Promise))((function(i,s){function r(e){try{c(t.next(e))}catch(e){s(e)}}function d(e){try{c(t.throw(e))}catch(e){s(e)}}function c(e){var n;e.done?i(e.value):(n=e.value,n instanceof o?n:new o((function(e){e(n)}))).then(r,d)}c((t=t.apply(e,n||[])).next())}))}const t=t=>{const{id:i,documentServerUrl:s,config:r,document_fileType:d,document_title:c,documentType:a,editorConfig_lang:u,height:l,type:v,width:w,onLoadComponentError:p,events_onAppReady:R,events_onDocumentStateChange:g,events_onMetaChange:m,events_onDocumentReady:h,events_onInfo:y,events_onWarning:f,events_onError:D,events_onRequestSharingSettings:E,events_onRequestRename:q,events_onMakeActionLink:_,events_onRequestInsertImage:I,events_onRequestSaveAs:A,events_onRequestMailMergeRecipients:C,events_onRequestCompareFile:S,events_onRequestEditRights:P,events_onRequestHistory:b,events_onRequestHistoryClose:k,events_onRequestHistoryData:M,events_onRequestRestore:H}=t;n((()=>{var e;(null===(e=null===window||void 0===window?void 0:window.DocEditor)||void 0===e?void 0:e.instances[i])&&(window.DocEditor.instances[i].destroyEditor(),window.DocEditor.instances[i]=void 0,console.log("Important props have been changed. Load new Editor."),x())}),[s,JSON.stringify(r),d,c,a,u,l,v,w]),n((()=>{let e=s;e.endsWith("/")||(e+="/");return((e,n)=>o(void 0,void 0,void 0,(function*(){return new Promise(((o,t)=>{try{if(document.getElementById(n)){if(window.DocsAPI)return o(null);let e=setInterval((()=>{if(window.DocsAPI)return clearInterval(e),o(null)}),500)}else{const i=document.createElement("script");i.setAttribute("type","text/javascript"),i.setAttribute("id",n),i.onload=o,i.onerror=t,i.src=e,i.async=!0,document.body.appendChild(i)}}catch(e){console.error(e)}}))})))(`${e}web-apps/apps/api/documents/api.js`,"onlyoffice-api-script").then((()=>x())).catch((()=>L(-2))),()=>{var e;(null===(e=null===window||void 0===window?void 0:window.DocEditor)||void 0===e?void 0:e.instances[i])&&(window.DocEditor.instances[i].destroyEditor(),window.DocEditor.instances[i]=void 0)}}),[]);const x=()=>{var e,n;try{if(window.DocsAPI||L(-3),null===(e=null===window||void 0===window?void 0:window.DocEditor)||void 0===e?void 0:e.instances[i])return void console.log("Skip loading. Instance already exists",i);(null===(n=null===window||void 0===window?void 0:window.DocEditor)||void 0===n?void 0:n.instances)||(window.DocEditor={instances:{}});let o=Object.assign({document:{fileType:d,title:c},documentType:a,editorConfig:{lang:u},events:{onAppReady:T,onDocumentStateChange:g,onMetaChange:m,onDocumentReady:h,onInfo:y,onWarning:f,onError:D,onRequestSharingSettings:E,onRequestRename:q,onMakeActionLink:_,onRequestInsertImage:I,onRequestSaveAs:A,onRequestMailMergeRecipients:C,onRequestCompareFile:S,onRequestEditRights:P,onRequestHistory:b,onRequestHistoryClose:k,onRequestHistoryData:M,onRequestRestore:H},height:l,type:v,width:w},r||{});const t=window.DocsAPI.DocEditor(i,o);window.DocEditor.instances[i]=t}catch(e){console.error(e),L(-1)}},L=e=>{let n;switch(e){case-2:n="Error load DocsAPI from "+s;break;case-3:n="DocsAPI is not defined";break;default:n="Unknown error loading component",e=-1}void 0===p?console.error(n):p(e,n)},T=()=>{R(window.DocEditor.instances[i])};return e.createElement("div",{id:i})};t.defaultProps={height:"100%",width:"100%"};export{t as DocumentEditor};
